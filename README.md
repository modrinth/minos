# Minos
Modrinth authentication backend using Ory Kratos

Includes:
- a small Actix server that demos an authentication process in a middleware (Minos)
- a Nuxt example that goes through the Ory login flow with customizable UI

You can view the Actix readme [here](minos/README.md), and the Nuxt readme [here](nuxt-3-example/README.md).

# Setup



For Minos, we are using the Ory self-hosted version.

You can run this by running:

- `docker-compose up` (or `docker-compose --build --force-recreate` if you need to rebuild the images).

--- 

In addition, there's a `kratos-only` docker compose file you can run if you only want Ory Kratos packages running. You will have to run Minos + the nuxt frontend separately if you do. You can view the Actix setup [here](minos/README.md), and the Nuxt setup [here](nuxt-3-example/README.md).

- `docker-compose up --f docker-compose-kratos-only.yml`

- If you use the `kratos-only` version, you will likely not be able to access the admin console for Ory through Nuxt/Rust, as they are no longer part of the docker-compose and the admin ports are not exposed publically. If you are testing and require access, you can change the .env variable to access `127.0.0.1:` instead of `kratos:` and also uncomment the admin port in `docker-compose-kratos-only.yml` to expose it.

- To reset the volumes & database, use `docker-compose down -v`

- Most of the time used for `docker-compose up` is copying/compiling the Rust code. You can comment this part out or use the kratos-only image to alleviate the long compose time.

- In addition, for testing purposes, you can comment out the 'pasiphae' section and uncomment the 'kratos-selfservice-ui-node' section to use the Ory default UI package.


# Documentation

The skeleton here uses the @ory sdk. This let's us use the Ory endpoints a little more conviently than just straight calling them.
- API can be found [here for TS](https://github.com/ory/sdk/tree/master/clients/client/typescript) and [here for Rust](https://github.com/ory/sdk/blob/master/clients/client/rust/docs/FrontendApi.md#update_settings_flow).
- Both of these (and the sdk themselves) are autogenerated. I found the rust doc a lot more helpful to me even when doing the Vue demo- because its autogenerated the function names were the same if I just converted snake_case to camelCase.

- [Integration to custom UI](https://www.ory.sh/docs/kratos/bring-your-own-ui/custom-ui-basic-integration)

- [Quickstart with self-hosting](https://www.ory.sh/docs/kratos/quickstart)

- [Ory Console](https://console.ory.sh/) (for managing an existing Ory project hosted on Ory)



# Ports:

- **4000: Minos Actix server.**
- **4433: Kratos API**
- 4434: Kratos admin API
- **4436: Mailslurper ports (for demoing email)**
- 4437:4437: Mailslurper ports (for demoing email)
- **4455: Nuxt 3 webserver.**
- 24678:24678: Nuxt communication port
- 24679:24679: Nuxt communication port


# Notes

- The recovery flow is incomplete for the Ory-hosted version, as there is currently no setup SMTP response server there. (There is a dummy SMTP server on the selfhosted verision)

- The self-hosted version with our UI does not quite work yet, even when all addresses are 127.0.0.1. It can be started but gives CORS errors (I suspect because ports are different and because our UI is not on docker-compose intranet with the other services).